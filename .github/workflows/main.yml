name: Build 3DS Manual

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    container: devkitpro/devkitarm:latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build the 3DSX
        run: |
          # 1. Load environment variables using '.' (compatible with all shells)
          # We use the absolute path provided by devkitPro containers
          . /opt/devkitpro/3dsvars.sh

          # 2. Compile and Link
          # $DEVKITARM is now set correctly by the script above
          $DEVKITARM/bin/arm-none-eabi-g++ -O2 -mword-relocations \
          -fomit-frame-pointer -ffunction-sections \
          -march=armv6k -mtune=mpcore -mfloat-abi=hard -mtp=soft \
          -specs=3dsx.specs \
          -I$DEVKITPRO/libctru/include \
          source/main.cpp \
          -L$DEVKITPRO/libctru/lib -lctru -lm \
          -o FragranceMaker.elf

          # 3. Convert to 3DSX
          # Tools are located in the tools/bin directory
          $DEVKITPRO/tools/bin/3dsxtool FragranceMaker.elf FragranceMaker.3dsx --romfs=romfs

      - name: Upload Finished App
        uses: actions/upload-artifact@v4
        with:
          name: 3DS-Homebrew-Build
          path: FragranceMaker.3dsx
