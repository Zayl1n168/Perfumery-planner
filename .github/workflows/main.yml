name: Build 3DS Manual

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    container: devkitpro/devkitarm:latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build the 3DSX
        run: |
          # 1. Load environment variables
          . /opt/devkitpro/3dsvars.sh

          # 2. Compile and Link
          $DEVKITARM/bin/arm-none-eabi-g++ -O2 -mword-relocations \
          -fomit-frame-pointer -ffunction-sections \
          -march=armv6k -mtune=mpcore -mfloat-abi=hard -mtp=soft \
          -specs=3dsx.specs \
          -I$DEVKITPRO/libctru/include \
          source/main.cpp \
          -L$DEVKITPRO/libctru/lib -lctru -lm \
          -o FragranceMaker.elf

          # 3. Convert to 3DSX with automatic metadata generation
          # We add the --smdh flag to create a basic icon/title automatically
          $DEVKITPRO/tools/bin/3dsxtool FragranceMaker.elf FragranceMaker.3dsx \
          --romfs=romfs \
          --smdh=FragranceMaker.smdh:"Fragrance Maker":"The Fragrance Planner":"Homebrew"

      - name: Upload Finished App
        uses: actions/upload-artifact@v4
        with:
          name: 3DS-Homebrew-Build
          path: FragranceMaker.3dsx
